<!-- Paste this into your HTML file -->
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDxSKU85aMBBL6jNvHiaihnWA-vApp-dVk",
      authDomain: "votw-tracker.firebaseapp.com",
      projectId: "votw-tracker",
      storageBucket: "votw-tracker.firebasestorage.app",
      messagingSenderId: "554314433668",
      appId: "1:554314433668:web:9818e708d793dcfad2eed1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VOTW Tracker</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #2e1a32, #2e1e23);
      color: #fff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .topnav {
      display: flex;
      background-color: #1c1020;
      padding: 10px 20px;
      border-bottom: 2px solid #4d2d3e;
    }
    .topnav button {
      margin-right: 10px;
      background: #3e2337;
      color: #fff;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .topnav button.active {
      background-color: gold;
      color: black;
      font-weight: bold;
    }
    .content {
      flex: 1;
      display: flex;
    }
    .sidebar, .main {
      padding: 20px;
    }
    .sidebar {
      width: 300px;
      background-color: #2b162a;
      border-right: 2px solid #5c3b4e;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .tab {
      padding: 6px 12px;
      background: #3e2337;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }
    .tab.active {
      background: gold;
      color: #000;
      font-weight: bold;
    }
    .quest-list {
      list-style: none;
      padding: 0;
    }
    .quest-list li {
      padding: 8px 12px;
      margin-bottom: 6px;
      background: #1f0f1a;
      border-left: 5px solid transparent;
      border-radius: 4px;
      cursor: pointer;
    }
    .quest-list li.high { border-left: 5px solid red; }
    .quest-list li.medium { border-left: 5px solid orange; }
    .quest-list li.low { border-left: 5px solid yellow; }
    .quest-list li.active {
      background: #2a1120;
      font-weight: bold;
    }
    .main {
      flex: 1;
      padding: 30px;
    }
    .quest-title {
      font-size: 24px;
      font-weight: bold;
      color: gold;
      margin-bottom: 20px;
    }
    .quest-lead, .quest-meta {
      color: #d2c6ca;
      margin-bottom: 10px;
    }
    .quest-meta div {
      margin-bottom: 5px;
    }
    #quest-modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #quest-modal > div {
      background: #2e1a32;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      position: relative;
    }
    #quest-modal input, #quest-modal select {
      width: 100%;
      margin-bottom: 5px;
      padding: 8px;
      border: none;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="topnav">
    <button class="active" onclick="showSection('quest-tracker', this)">Quest Tracker</button>
  </div>
  <div class="content" id="quest-tracker">
    <div class="sidebar">
      <div class="tabs">
        <div class="tab active" onclick="switchTab('active')">Active</div>
        <div class="tab" onclick="switchTab('completed')">Completed</div>
        <div class="tab" onclick="switchTab('failed')">Failed</div>
      </div>
      <!-- FILTER UI -->
      <div style="margin-bottom: 10px;">
        <select id="priority-filter" onchange="renderQuests()" style="width: 100%; margin-bottom: 5px;">
          <option value="">All Priorities</option>
          <option value="high">High</option>
          <option value="medium">Medium</option>
          <option value="low">Low</option>
        </select>
        <select id="type-filter" onchange="renderQuests()" style="width: 100%;">
          <option value="">All Types</option>
          <option value="Personal">Personal</option>
          <option value="Party">Party</option>
        </select>
      </div>
      <ul class="quest-list" id="quest-list"></ul>
      <button onclick="openModal()" style="margin-top: 20px; width: 100%; padding: 10px; background: #4e2d3a; color: white; border: none; border-radius: 4px; cursor: pointer;">‚ûï Add Quest</button>
    </div>
    <div class="main" id="quest-details">
      <div class="quest-title">Select a quest</div>
      <div class="quest-lead">Quest details will appear here.</div>
      <div class="quest-meta"></div>
      <div style="margin-top: 20px;">
        <button onclick="editQuest()" style="padding: 8px 16px; margin-right: 10px; background: orange; border: none; border-radius: 4px; color: black;">‚úèÔ∏è Edit</button>
        <button onclick="deleteQuest()" style="padding: 8px 16px; background: red; border: none; border-radius: 4px; color: white;">üóëÔ∏è Delete</button>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div id="quest-modal">
    <div>
      <h2 style="margin-top:0; color:gold;" id="modal-title">Add/Edit Quest</h2>
      <input type="text" id="quest-title" placeholder="Title" />
      <input type="text" id="quest-lead" placeholder="Lead" />
      <input type="text" id="quest-giver" placeholder="Giver" />
      <input type="text" id="quest-type" placeholder="Type (Personal/Party)" />
      <input type="text" id="quest-location" placeholder="Location" />
      <input type="text" id="quest-time" placeholder="Time Remaining" />
      <input type="text" id="quest-notes" placeholder="Notes" />
      <input type="text" id="quest-reward" placeholder="Reward" />
      <select id="quest-priority">
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>
      <button id="modal-submit-btn" style="width:100%; padding:8px; background: gold; color:black; font-weight:bold; border:none; border-radius:4px;">Save</button>
      <button onclick="closeModal()" style="position:absolute; top:10px; right:10px; background:none; border:none; color:white; font-size:18px; cursor:pointer;">‚úñ</button>
    </div>
  </div>

  <script>
    const questData = { active: [], completed: [], failed: [] };
    let currentTab = 'active';
    let selectedQuestIndex = null;
    let editingQuestId = null;

    db.collection("quests").get().then(snapshot => {
      snapshot.forEach(doc => {
        const quest = doc.data();
        quest.id = doc.id;
        if (quest.status && questData[quest.status]) {
          questData[quest.status].push(quest);
        }
      });
      renderQuests();
    });

    function renderQuests() {
      const list = document.getElementById('quest-list');
      list.innerHTML = '';
      if (!questData[currentTab]) return;

      const priorityFilter = document.getElementById('priority-filter').value;
      const typeFilter = document.getElementById('type-filter').value;

      const filtered = questData[currentTab].filter(q => {
        const matchesPriority = priorityFilter === '' || q.priority === priorityFilter;
        const matchesType = typeFilter === '' || (q.type && q.type.toLowerCase() === typeFilter.toLowerCase());
        return matchesPriority && matchesType;
      });

      filtered.forEach((quest, index) => {
        const li = document.createElement('li');
        li.innerText = quest.title;
        li.classList.add(quest.priority);
        li.onclick = () => selectQuest(index, filtered);
        if (index === 0) li.classList.add('active');
        list.appendChild(li);
      });

      if (filtered.length > 0) {
        selectQuest(0, filtered);
      } else {
        document.querySelector('.quest-title').innerText = 'No quests match the filt
